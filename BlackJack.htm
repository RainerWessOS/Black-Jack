<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8" />
    <title>Spiel 17 + 4</title>
     <meta name="Keywords" content="Spiel, Kartenspiel, 17 + 4, siebzehn und vier, game, card game, Black Jack, Handy App, mobile phone, open source, GPL, freeware, HTML, CSS, JavaScript">
     <meta name="Description" content="JavaScript implementation of the game Black Jack">
	<meta name="Author" content="Rainer Wess">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
<style>

body {
   width: 370px; 
   margin: auto; 
   font-weight: bold;
   background-color: darkgreen;
   overflow:hidden;
}

.header {
   font-size: 32px; 
   text-align: center; 
   color: red; 
   text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;
   margin:  20px auto 30px auto; 
}

.table1 { 
   margin: 10px auto 40px auto; 
   height: 80px; 
   padding: 10px; 
}

.table2 { 
  margin: 10px auto 30px auto; 
  height: 80px; 
  padding: 10px; 
}

.player { 
	font-size: 20px;
	width: 100%;
	align: center;
   margin-left: 10px; 
   color : white;
}

.placeDiv {
   height: 80px; 
   width: 55px; 
   align: center;
   float: left; 
   // box-shadow: 2px 2px #303030; 
}

#div0, #div1, #div2, #div3, #div5, #div6, #div7, #div8 { 
   margin-right: 15px; 
}

.Btn  {
   font-size: 18px; 
   color: white;
   height: 35px;
   margin: 10px; 
   font-weight: bold;
   border-color: white; 
   border-radius: 5px; 
   box-shadow: 3px 3px #303030; 
   float: left;
}

#takeBtn { 
    background-color: green; 
}

#standBtn {
   background-color: red; 
}

#newBtn {
    background-color: black;
}

#info, #busted { 
	margin-left: 55px;
	text-align: center;
	align: center;
}

#points_cpu, #points_usr { 
	float: right;
	margin-right:40px;
	text-align: right;
	align: right;
}

p {
   font-size: 20px; 
   clear: both;
}

</style>

<script>
	
/*
*  Black Jack - (17+4) 
*  Copyright  Rainer Wess 2018
*  Open Source / Freeware
*  Released under GNU GPL 3.0
*/

var points_usr;
var points_cpu;
var sum_usr;
var sum_cpu;
var place_usr;
var place_cpu;
var randNum;
var running;
var first_card;
var ani = false;
var intA;
var i;
var card = [];

for (i = 0; i <= 51; i++) {
	card[i] = new Image();
	card[i].src = "cards/card"+ i + ".png";
	card[i].style.height = "80px";
    card[i].style.width = "55px";
}

var revcard = new Image();
revcard.src = "cards/reverse.png";
var nocard = new Image();
nocard.src = "cards/nocard.png";

var card_value = [ 11, 2, 3, 4, 5, 6, 7, 8, 9, 10, 10, 10, 10];

function id(id) {
	return document.getElementById(id);
}

function setImg(pn, num) {
	 id("place" +pn).src = card[num].src;
}

function setText(sid, txt) {
	id(sid).innerHTML = txt;
}

function randomNumber(min, max) {
	return Math.floor(Math.random() * (max - min + 1)) + min;
}

function enableButtons() {
	id("takeBtn").disabled = false;
    id("standBtn").disabled = false;
    id("newBtn").disabled = false;
}

function disableButtons() {
	 id("takeBtn").disabled = true;
     id("standBtn").disabled = true;
}

function setColor(sid, scolor) {
	id(sid).style.color = scolor;
}

function aniWin() {
	ani = (ani) ? false : true;
	if (ani) setColor("info", "darkgreen");
    else setColor("info", "gold");
}


function init() {

    points_usr = 0;
    setText("points_usr", points_usr);
    points_cpu = 0;
    setText("points_cpu", points_cpu);
    newGame();
}

function newGame() {
	
    sum_usr = 0;
    sum_cpu = 0;
	place_usr = 0;
	place_cpu = 5;
	running = true;
	first_card = true;
	id("newBtn").blur();
	disableButtons();
	
	if (intA) clearInterval(intA);
	ani = false;
	setText("info", " ");
	setText("cpu", "0");
    setText("you", "0");

	for (i = 0; i <= 9; i++) {
	    id("place" + i).src = nocard.src;
    }
  
    setTimeout(showReversedCard, 500);
    setTimeout(cpuTakeCard, 1000);
    setTimeout(usrTakeCard, 1500);
    setTimeout(enableButtons, 1600);
 }
 
 function showReversedCard() {
     id("place6").src = revcard.src;
 }

function usrTakeCard() {
	
   id("takeBtn").blur();
   
   if (running) {
       if (sum_usr <= 21) {
           randNum =  randomNumber( 0, 51);
           setImg(place_usr, randNum);
           place_usr ++;
           sum_usr += card_value[randNum % 13];
           setText("you",  sum_usr);
           if (sum_usr > 20) {
        	   disableButtons();
               whoWins() ;
           }
       }
       // sometimes five cards are not enough to come close to 21 
      // ToDo: posibility to shift the drawn cards in the places, if more cards have to be drawn then places available
       if (place_usr > 4 ) stand();
   }
}

function cpuTakeCard() {
   
   if (running) {
       if (  first_card || ( sum_cpu < 19 && sum_cpu < sum_usr ) ) {
       	first_card = false;
           randNum =  randomNumber( 0, 51);
           setImg(place_cpu, randNum);
           place_cpu ++;
           sum_cpu += card_value[randNum % 13];
           setText("cpu",  sum_cpu);
       }     
       // sometimes five cards are not enough to win or come close to 21
       else if (place_cpu == 10) whoWins();
       else whoWins();
   }
}
 
 function stand() {
 	// computer      
     var wait = 0;
 
     id("standBtn").blur();
     disableButtons();
     
     for (i = 0; i < 4; i++) {
     	if ( sum_usr > sum_cpu  &&  sum_cpu < 19 ) {
	         setTimeout(cpuTakeCard, wait);
	         wait += 1000;
	     }
     }
 }
 
 function whoWins() {
 	if (running) {
 	  if (sum_usr > 21 || ( sum_cpu <= 21 && sum_cpu > sum_usr && sum_usr > 0) ) {
 	       running = false;
            setColor("info", "white");
            setText("info", "You lose.");
            points_cpu += 1;
            setText("points_cpu", points_cpu);
       }
       else if (sum_cpu > 21 || sum_usr == 21 || ( sum_usr <= 21 && sum_usr > sum_cpu) ) {
       	running = false;
           setColor("info", "gold");
           setText("info", "You Win!");
           intA = setInterval(aniWin, 700);
           points_usr += 1;
           setText("points_usr", points_usr);
       }
       else  if (sum_cpu > 0 && sum_usr == sum_cpu) {   
           running = false;
           setColor("info", "white")
           setText("info", "It's a tie!");
       }
    }
 }
 
</script>


</head>

<body onload="init()">
<div class="header">Black Jack</div>
<div class="player">CPU : <span id="cpu">0</span> <span id="busted"> </span><span id="points_cpu"> 0</span></div>

<div class="table1">
	    <div id="div6" class="placeDiv"><img id="place6" src="cards/nocard.png"></div>
    <div id="div5" class="placeDiv"><img id="place5" src="cards/nocard.png"></div>
    <div id="div7" class="placeDiv"><img id="place7" src="cards/nocard.png"></div>
    <div id="div8" class="placeDiv"><img id="place8" src="cards/nocard.png"></div>
    <div id="div9" class="placeDiv"><img id="place9" src="cards/nocard.png"></div>
</div>

<div class="player">You : <span id="you">0</span> <span id="info"> </span><span id="points_usr"> 0</span></div>

<div class=table2>
    <div id="div0" class="placeDiv"><img id="place0" src="cards/nocard.png"></div>
    <div id="div1" class="placeDiv"><img id="place1" src="cards/nocard.png"></div>
    <div id="div2" class="placeDiv"><img id="place2" src="cards/nocard.png"></div>
    <div id="div3" class="placeDiv"><img id="place3" src="cards/nocard.png"></div>
    <div id="div4" class="placeDiv"><img id="place4" src="cards/nocard.png"></div>
</div>

<button id="takeBtn" class="Btn" onclick="usrTakeCard()">TAKE CARD</button>
<button id="standBtn" class="Btn"  onclick="stand()">STAND</button>
<button id="newBtn" class="Btn"  onclick="newGame()">NEW GAME</button>

</body>
</html>